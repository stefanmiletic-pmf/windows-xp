<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">src/Viewers/widgets/TaskbarModule.js</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#controllers">Controllers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Controllers/ControllerFileBase.js~ControllerFileBase.html">ControllerFileBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Controllers/ControllerFileTXT.js~ControllerFileTXT.html">ControllerFileTXT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Controllers/ControllerPlatform.js~ControllerPlatform.html">ControllerPlatform</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Controllers/ControllerProperties.js~ControllerProperties.html">ControllerProperties</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jQuery">jQuery</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#models">Models</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Models/File.js~File.html">File</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Models/FileProperties.js~FileProperties.html">FileProperties</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Models/FileText.js~FileText.html">FileText</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utilis">Utilis</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Utilis/FunctionsFrontend.js~FunctionsFrontend.html">FunctionsFrontend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Utilis/Logger.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Utilis/QueryController.js~QueryController.html">QueryController</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#viewers">Viewers</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/ViewerBase.js~ViewerBase.html">ViewerBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/ViewerIcon.js~ViewerIcon.html">ViewerIcon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/ViewerPlatform.js~ViewerPlatform.html">ViewerPlatform</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/ViewerProperties.js~ViewerProperties.html">ViewerProperties</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/ViewerTXT.js~ViewerTXT.html">ViewerTXT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/ViewerUtilis.js~ViewerUtilis.html">ViewerUtilis</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getZindex">getZindex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-zIndex">zIndex</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#viewers-builders">Viewers/Builders</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/Builders/WindowBuilder.js~WindowBuilder.html">WindowBuilder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/Builders/WindowBuilderFilePropertiesDirector.js~WindowBuilderFilePropertiesDirector.html">WindowBuilderFilePropertiesDirector</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/Builders/WindowBuilderTXTDirector.js~WindowBuilderTXTDirector.html">WindowBuilderTXTDirector</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#viewers-widgets">Viewers/widgets</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/widgets/Highlight.js~Highlight.html">Highlight</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/widgets/ModuleBase.js~ModuleBase.html">ModuleBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/widgets/PanelCreator.js~PanelCreator.html">PanelCreator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/widgets/RenamingModule.js~RenamingModule.html">RenamingModule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Viewers/widgets/TaskbarModule.js~TaskbarModule.html">TaskbarModule</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Viewers/widgets/TaskbarModule.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import FunctionsFrontend from &quot;../../Utilis/FunctionsFrontend.js&quot;;
import QueryController from &quot;../../Utilis/QueryController.js&quot;;
import {getZindex} from &quot;../ViewerUtilis.js&quot;;
import ModuleBase from &quot;./ModuleBase.js&quot;;

export default class TaskbarModule extends ModuleBase{
	
	/**
	 *Creates an instance of TaskbarModule.
	 * @param {*} params
	 */
	constructor(params) {
		super(params.taskbarModule.viewer_as_arg,
		params.taskbarModule.actionDependOn,
		params.taskbarModule.actionResetModules);
		
		var params = params.taskbarModule;
		
		var callbacks = params[&quot;callbacks&quot;];
		/**
		 * Appends child to the viewer platform.
		 * @type {function} 
		 * @public
		 */
		this.appendChildCustom = callbacks[&quot;appendChildCustom&quot;];
		/**
		 * Gets user name.
		 * @type {function} 
		 * @public
		 */
		this.getUserName = callbacks[&quot;getUserName&quot;];
		/**
		 * Logs off user.
		 * @type {function} 
		 * @public
		 */
		this.logOff = callbacks[&quot;logOff&quot;];
		/**
		 * Gets system logger.
		 * @type {function} 
		 * @public
		 */
		this.getLogger = callbacks[&quot;getLogger&quot;];
		
		/**
		 * Taskbar dom.
		 * @type {DOM} 
		 * @public
		 */
		this.taskbar = null;
			
		/**
		 * Tasks in taskbar.
		 * @type {dictionary} 
		 * @public
		 */
		this.tasks = {};
		/**
		 * Currently active tasks in taskbar.
		 * @type {DOM} 
		 * @public
		 */
		this.currentlyActive = null;

		/**
		 * Currently active tasks in taskbar.
		 * @type {DOM} 
		 * @public
		 */
		this.taskbarList = null;
		
		this.initTaskBarView();
	}
	

	/**
	 * Creates taskbar.
	 * @returns {void}
	 */	
	initTaskBarView() {
		
		
		
		this.taskbar = document.createElement(&quot;div&quot;);
		this.taskbar.className = &quot;taskbar&quot;;
		
		this.taskbarList = document.createElement(&quot;div&quot;);
		this.taskbarList.className = &quot;taskbarList&quot;;
		
		this.taskbar.appendChild(this.taskbarList);
		
		var clock = this.createClock();
		this.taskbar.appendChild(clock);
		
		var start_btn = document.createElement(&quot;div&quot;);
		start_btn.className = &quot;taskbar-btn-start&quot;;
		this.taskbar.appendChild(start_btn);
		
		
		var start_menu = this.createMenu(start_btn);
		
		var generators = [{name: &quot;Session report&quot;, callback: this.pdf_session_report_generator_callback.bind(this)}];
		
		if ( this.getUserName() == &quot;admin&quot; ) {
			
			generators.push({
				
				name: &quot;System report&quot;, 
				callback: this.pdf_system_report_generator_callback.bind(this)
				
			});
			
		}
		
		this.appendGeneratorsIcons(generators, start_menu);
		
		
		
		this.appendChildCustom(start_menu);
		this.appendChildCustom(this.taskbar);
		
	}

	/**
	 * Creates start menu.
	 * @param {DOM} start_btn - Start button dom.
	 * @returns {void}
	 */	
	
	createMenu(start_btn) {
		
		var viewer_as_arg = this;
		
		var menu = document.createElement(&quot;div&quot;);
		menu.className = &quot;main-menu&quot;;
		
		var user_name = document.createElement(&quot;span&quot;);
		user_name.className = &quot;main-menu-user-name&quot;;
		user_name.innerHTML = this.getUserName();
		
		var btn_log_off = document.createElement(&quot;div&quot;);
		btn_log_off.className = &quot;main-menu-log-off&quot;;
		
		btn_log_off.addEventListener(&quot;click&quot;, function() {
			
			this.logOff();
			
		}.bind(this));
		
		menu.appendChild(user_name);
		menu.appendChild(btn_log_off);
		
		
			
		start_btn.addEventListener(&quot;click&quot;, function(e) {
			
			if (menu.style.visibility == &quot;visible&quot;)
				menu.style.visibility = &quot;hidden&quot;;
			else
				menu.style.visibility = &quot;visible&quot;;
			
			e.stopPropagation();
			
		}, true);
		
		
		return menu;
		
	}
	
	
	/**
	 * Returns activness of this module.
	 * @returns {boolean}
	 */	
	isActive() {
		return false;
	}
	

	/**
	 * Resets this module.
	 * @returns {void}
	 */	
	reset() {
		
	}
	
	
	/**
	 * Adds task to the taskbar.
	 * @param {string} name - name of the task.
	 * @returns {void}
	 */	
	addTask(name) {
		this.makeCurrentlyActiveTaskUnActive();
		
		var task = document.createElement(&quot;div&quot;);
		this.currentlyActive = task;
		task.className = &quot;task activeTask&quot;;
		this.tasks[name] = task;
		
		var taskIcon = document.createElement(&quot;div&quot;);
		taskIcon.className = &quot;taskIcon&quot;;
		
		var taskTitle = document.createElement(&quot;div&quot;);
		taskTitle.className = &quot;taskTitle&quot;;
		taskTitle.innerHTML = name;
		
		
		task.addEventListener(&quot;click&quot;, function() {
			this.switchActiveTaskTo(name);
			document.getElementById(name).style.zIndex = getZindex();
			
		}.bind(this));
		
		
		task.appendChild(taskIcon);
		task.appendChild(taskTitle);
		this.taskbarList.appendChild(task);
		
	}
	
	
	/**
	 * Removes task from the taskbar.
	 * @param {string} name - name of the task.
	 * @returns {void}
	 */	
	removeTask(name) { 
		
		var dom = this.tasks[name];
		this.taskbarList.removeChild(dom);
		delete this.tasks[name];
		
	}
		
	/**
	 * Makes currently active task in the taskbar unactive.
	 * @returns {void}
	 */
	makeCurrentlyActiveTaskUnActive() {
		
		if ( !this.currentlyActive)
			return;
		
		var task = this.currentlyActive;
		var class_name = task.className;
		class_name = class_name.replace(&quot;activeTask&quot;, &quot;&quot;);
		task.className = class_name
		this.currentlyActive = null;
	}


	 /**
	 * Creates start menu.
	 * @param {string} name - Name of the tast to be switched to.
	 * @returns {void}
	 */	
	switchActiveTaskTo(name) {
		
		this.makeCurrentlyActiveTaskUnActive();
		this.tasks[name].className += &quot;activeTask&quot;;
		this.currentlyActive = this.tasks[name];
		
	}

	/**
	 * Returns if the currently active task having the name.
	 * @param {string} name - name of the task.
	 * @returns {boolean}
	 */
	checkIfWindowIsCurrentlyActive(name) {
		return this.tasks[name] == this.currentlyActive;
	}

	/**
	 * Appends report generator icons.
	 * @param {Array} _generator_array - Generators array.
	 * @param {DOM} start_menu - Start menu dom.
	 * @returns {void}
	 */	
	appendGeneratorsIcons(_generator_array, start_menu) {
		
		
		for(var i=0;i &lt;_generator_array.length; ++i) {
			
			var _generator = _generator_array[i];
			var name = _generator.name;
			var callback = _generator.callback;
			
			
			var icon_file = document.createElement(&quot;div&quot;);
			icon_file.className = &quot;generator_icon &quot; + name.split(&quot; &quot;)[0].toLowerCase() + &quot;_report &quot; + &quot;pdf-generator-icon&quot;;
			
			var icon_txt = document.createElement(&quot;h4&quot;);
			icon_txt.className = &quot;txt-icon-title&quot;;
			icon_txt.innerHTML = name;
			
			icon_file.addEventListener(&quot;click&quot;, function() {
				
				
				//console.log(&quot;cliick generator&quot;);
				//console.log(this.callback);
				
				this.callback();
				
			}.bind({callback: callback}), true);
			
			icon_file.appendChild(icon_txt);
			
			start_menu.appendChild(icon_file);
			
			
		}
		
		
		
	}	
	
	/**
	 * Pdf system report callback.
	 * @returns {void}
	 */
	pdf_system_report_generator_callback() {
		
		var callback_success = function(response){
			
			
			//console.log(response);
			
			var response = JSON.parse(response);
			var reportArray = [];
			for ( var i=0; i &lt; response.length; ++i) {
				
				
				var node = response[i];
				
				var record_desc = node[&quot;record&quot;];
				var createdBy = node[&quot;createdBy&quot;];
				var time = FunctionsFrontend.getTimeATMForSystemLogRecord(node[&quot;timestamp&quot;]);
				
				
				var record = time + &quot; | &quot; + record_desc;
				
				if (record.length &gt; 69) {
					for (var j = 0; j &lt; record.length; j+=69) {
							var end = Math.min(j+69, record.length);
							reportArray.push(record.substring(j, end));
							
						}
						
				} else {
					reportArray.push(record);
				
				}
				
				 reportArray.push(&quot;Action by: &quot; + createdBy + &quot;.&quot;);
			}
			
			
		
			var doc = new jsPDF()
			
			
			
			doc.text(reportArray,20, 20);
			
			
			var today = new Date();
			var dd = String(today.getDate()).padStart(2, &apos;0&apos;);
			var mm = String(today.getMonth() + 1).padStart(2, &apos;0&apos;); //January is 0!
			var yyyy = today.getFullYear();
			
			var time = dd + &apos;-&apos; + mm + &apos;-&apos; + yyyy;
					
			
			
			doc.save(this.getUserName() + &apos;-system-report-&apos; + time + &apos;.pdf&apos;);
			
		}.bind(this);
		var callback_error = function(response){
			
			console.log(&quot;ERROR REPORTING SYSTEM LOG&quot;);
		};
		
		QueryController.executeQuery({&quot;getSystemLog&quot;: true}, callback_success, callback_error);
		
	}
	
	/**
	 * Pdf session report callback.
	 * @returns {void}
	 */
	pdf_session_report_generator_callback() {
	
		
		var doc = new jsPDF()
		
		
		
		doc.text(this.getLogger().generate_array_of_strings(),20, 20);
		
		
		var today = new Date();
		var dd = String(today.getDate()).padStart(2, &apos;0&apos;);
		var mm = String(today.getMonth() + 1).padStart(2, &apos;0&apos;); //January is 0!
		var yyyy = today.getFullYear();
		
		var time = dd + &apos;-&apos; + mm + &apos;-&apos; + yyyy;
				
		
		
		doc.save(this.getUserName() + &apos;-session-report-&apos; + time + &apos;.pdf&apos;);
		
	}

	/**
	 * Creates clock.
	 * @returns {void}
	 */
	createClock() {
		
		var clockDOM = document.createElement(&quot;clock&quot;);
		clockDOM.className = &quot;clock&quot;;
		clockDOM.innerHTML = FunctionsFrontend.getTimeATMForTheClock();
		return clockDOM;
		
	}
	
	
}</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
